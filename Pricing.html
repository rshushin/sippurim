<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Pay ‚Ä¢ Sippurim Bot</title>

  <!-- Theme stylesheet (leave as‚Äëis) -->
  <link rel="stylesheet" href="assets/css/main.css" />
</head>
<body class="no-sidebar">
<div id="page-wrapper">

  <!-- ‚ñ∏ HEADER + NAV ----------------------------------------------------- -->
  <header id="header">
    <div class="container">
      <h1><a href="index.html">Sippurim Bot</a></h1>
      <p>Pay ‚Ä¢ –û–ø–ª–∞—Ç–∞</p>
    </div>

    <nav id="nav">
      <ul>
        <li><a class="icon solid fa-home" href="index.html"><span>Home</span></a></li>
        <li class="current"><a class="icon solid fa-tags" href="Pricing.html"><span>Pricing</span></a></li>
        <li><a class="icon solid fa-file" href="Refund.html"><span>Refund</span></a></li>
        <li><a class="icon solid fa-shield-alt" href="Privacy.html"><span>Privacy</span></a></li>
        <li><a class="icon solid fa-book" href="Terms.html"><span>Terms</span></a></li>
      </ul>
    </nav>
  </header>

  <!-- ‚ñ∏ MAIN CONTENT ----------------------------------------------------- -->
  <section id="main">
    <div class="container">
      <section id="content">
        <article class="box post">
          <header><h2>Price ‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å</h2></header>

          <!-- English -->
          <p lang="en">
            Lifetime access costs <strong>‚Ç¨10</strong> and unlocks 350 curated Israeli songs with vocabulary & lyric links.
          </p>

          <!-- Russian -->
          <p lang="ru">
            –ü–æ–∂–∏–∑–Ω–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø —Å—Ç–æ–∏—Ç <strong>10&nbsp;‚Ç¨</strong> –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç 350 –∏–∑—Ä–∞–∏–ª—å—Å–∫–∏—Ö –ø–µ—Å–µ–Ω —Å–æ —Å–ª–æ–≤–∞—Ä—ë–º –∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ —Ç–µ–∫—Å—Ç.
          </p>

          <!-- Buttons -->
          <ul class="actions">
            <!-- This button works for visitors who arrive WITHOUT a _ptxn parameter.
                 It creates a Transaction on your backend then opens the Paddle overlay. -->
            <li>
              <a id="buy-now" class="button primary" href="#">Buy&nbsp;now&nbsp;/&nbsp;–ö—É–ø–∏—Ç—å</a>
            </li>
          </ul>
        </article>
      </section>
    </div>
  </section>

  <!-- ‚ñ∏ FOOTER ----------------------------------------------------------- -->
  <footer id="footer">
    <div class="container">
      <p>&copy;&nbsp;2025 Sippurim. All rights reserved.</p>
    </div>
  </footer>

</div>

<!-- Core theme scripts -->
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/browser.min.js"></script>
<script src="assets/js/breakpoints.min.js"></script>
<script src="assets/js/util.js"></script>
<script src="assets/js/main.js"></script>

<!-- ‚ñ∏ Paddle checkout integration -------------------------------------- -->
<!-- ‚ñ∏ Paddle checkout integration - UPDATED FOR BOT INTEGRATION ------ -->
<script type="module">
import { initializePaddle, Paddle } from "https://cdn.jsdelivr.net/npm/@paddle/paddle-js/+esm";

/**
 * Initialize Paddle.js directly with seller ID (no token needed for basic setup)
 */
console.log('Initializing Paddle...');

initializePaddle({
  seller: 229973,  // Your Paddle seller ID
  environment: 'production',  // Use 'sandbox' for testing
  checkout: { 
    settings: { 
      displayMode: "overlay", 
      variant: "one-page",
      theme: "light"
    } 
  },
  eventCallback: ev => {
    console.log('Paddle event:', ev);
    
    if (ev.name === "checkout.completed") {
      // Show success message briefly
      const buyBtn = document.getElementById("buy-now");
      if (buyBtn) {
        buyBtn.innerHTML = "‚úÖ Payment completed! Redirecting...";
        buyBtn.disabled = true;
      }
      
      // Return to Telegram bot after payment
      setTimeout(() => {
        window.location.href = "https://t.me/Sippurim_Bot?start=payment_success";
      }, 2000);
    }
    
    if (ev.name === "checkout.closed") {
      // User closed checkout - reset button
      const buyBtn = document.getElementById("buy-now");
      if (buyBtn) {
        buyBtn.innerHTML = "Buy&nbsp;now&nbsp;/&nbsp;–ö—É–ø–∏—Ç—å";
        buyBtn.disabled = false;
      }
    }
    
    if (ev.name === "checkout.error") {
      console.error('Paddle checkout error:', ev.data);
      const buyBtn = document.getElementById("buy-now");
      if (buyBtn) {
        buyBtn.innerHTML = "‚ùå Error - Try again";
        buyBtn.disabled = false;
      }
    }
  }
});

/**
 * Check if this page was opened with a transaction ID from the bot
 */
const params = new URLSearchParams(window.location.search);
const txnId = params.get("_ptxn");

if (txnId) {
  console.log('Bot transaction detected:', txnId);
  
  // Show loading state for bot users
  const buyBtn = document.getElementById("buy-now");
  if (buyBtn) {
    buyBtn.innerHTML = "üîÑ Opening checkout...";
    buyBtn.disabled = true;
  }
  
  // Open Paddle checkout for the transaction from bot
  setTimeout(() => {
    Paddle.Checkout.open({ transactionId: txnId });
  }, 1000); // Small delay to ensure Paddle is fully loaded
}

/**
 * Handle direct website purchases - redirect to Telegram bot
 */
const buyBtn = document.getElementById("buy-now");
if (buyBtn && !txnId) {  // Only add listener if not a bot transaction
  buyBtn.addEventListener("click", async evt => {
    evt.preventDefault();
    
    // Redirect to Telegram bot for payment
    window.location.href = "https://t.me/Sippurim_Bot?start=buy";
  });
  
  // Update button text to indicate it goes to Telegram
  buyBtn.innerHTML = "ü§ñ Buy via Telegram Bot";
  buyBtn.style.background = "#0088cc"; // Telegram blue
}

// Add some visual feedback for bot users
if (txnId) {
  // Add a notice for bot users
  const contentSection = document.querySelector('#content article');
  if (contentSection) {
    const botNotice = document.createElement('div');
    botNotice.style.cssText = `
      background: #e3f2fd;
      border: 1px solid #2196f3;
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
      text-align: center;
      color: #1565c0;
    `;
    botNotice.innerHTML = `
      <strong>ü§ñ Payment from Hebrew Learning Bot</strong><br>
      <small>Secure checkout will open automatically...</small>
    `;
    contentSection.appendChild(botNotice);
  }
}
</script>
</body>
</html>
